# 视频下载器新手使用指南

本指南将帮助您从零开始学会使用这个多平台视频下载器，支持TikTok、小红书(XHS)和快手平台的视频下载。

## 📋 目录

1. [环境准备](#环境准备)
2. [安装程序](#安装程序)
3. [快速上手](#快速上手)
4. [详细配置](#详细配置)
5. [使用方法](#使用方法)
6. [常见问题](#常见问题)
7. [故障排除](#故障排除)

## 🛠️ 环境准备

### 系统要求

- **操作系统**: Windows 10/11, macOS 10.15+, 或 Linux
- **内存**: 至少 2GB RAM
- **存储空间**: 至少 500MB 可用空间（不包括下载的视频）
- **网络**: 稳定的互联网连接

### 必需软件

#### 1. 安装 Go 语言环境

**Windows 用户:**
1. 访问 [Go官网](https://golang.org/dl/)
2. 下载 Windows 安装包 (例: go1.21.windows-amd64.msi)
3. 双击安装包，按照向导完成安装

**macOS 用户:**
```bash
# 使用 Homebrew 安装（推荐）
brew install go

# 或者下载官方安装包
# 访问 https://golang.org/dl/ 下载 .pkg 文件
```

**Linux 用户:**
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install golang-go

# CentOS/RHEL
sudo yum install go

# 或者使用官方二进制包
wget https://golang.org/dl/go1.21.linux-amd64.tar.gz
sudo tar -C /usr/local -xvf go1.21.linux-amd64.tar.gz
echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc
source ~/.bashrc
```

#### 2. 验证 Go 安装
```bash
go version
# 应该显示类似: go version go1.21.0 linux/amd64
```

#### 3. 安装 Git（如果未安装）

**Windows:** 从 [Git官网](https://git-scm.com/) 下载安装

**macOS:** 
```bash
brew install git
```

**Linux:**
```bash
# Ubuntu/Debian
sudo apt install git

# CentOS/RHEL
sudo yum install git
```

## 💾 安装程序

### 方法一：从源码编译（推荐）

1. **克隆项目**
```bash
git clone https://github.com/httprunner/video-downloader.git
cd video-downloader
```

2. **安装依赖**
```bash
go mod download
```

3. **编译程序**
```bash
# 编译所有组件
make build

# 或者只编译CLI版本
make build-cli
```

编译完成后，您将在`bin/`目录下看到以下可执行文件：
- `bin/video-downloader` - 命令行版本（包含所有功能）
- `bin/video-downloader-server` - 独立服务器版本
- `bin/video-downloader-tui` - 交互式终端版本

### 方法二：直接安装（需要Go环境）

```bash
go install github.com/httprunner/video-downloader@latest
```

### 方法三：使用Docker（适合不想安装Go的用户）

```bash
# 构建Docker镜像
make docker-build

# 运行容器
make docker-run
```

## 🚀 快速上手

### 第一次使用

1. **创建配置文件**
```bash
# 进入程序目录
cd video-downloader

# 初始化配置（这会创建默认配置文件）
./bin/video-downloader config init
```

2. **测试下载单个视频**
```bash
# 下载一个TikTok视频（替换为真实URL）
./bin/video-downloader download "https://www.tiktok.com/@username/video/1234567890"
```

3. **检查下载结果**
```bash
# 查看已下载的视频列表
./bin/video-downloader list
```

### 基本命令介绍

```bash
# 下载单个视频
./bin/video-downloader download <视频URL>

# 获取视频信息（不下载）
./bin/video-downloader info <视频URL>

# 批量下载
./bin/video-downloader batch <URL文件>

# 启动Web服务器
./bin/video-downloader server

# 启动交互式界面
./bin/video-downloader-tui

# 查看帮助
./bin/video-downloader --help
```

## ⚙️ 详细配置

### 配置文件位置

配置文件位于 `./config/config.yaml`，首次运行时会自动创建。

### 重要配置项说明

#### 1. 下载设置
```yaml
download:
  max_workers: 5          # 同时下载的任务数
  chunk_size: 1048576     # 下载块大小(1MB)
  timeout: 300            # 下载超时时间(秒)
  retry_count: 3          # 重试次数
  save_path: ./downloads  # 下载保存路径
  create_folder: true     # 是否按平台创建文件夹
  file_naming: "{platform}_{author}_{title}_{id}"  # 文件命名格式
```

**文件命名占位符:**
- `{platform}`: 平台名称 (tiktok, xhs, kuaishou)
- `{author}`: 作者用户名
- `{title}`: 视频标题
- `{id}`: 视频ID
- `{date}`: 发布日期 (YYYY-MM-DD)

#### 2. 平台设置
```yaml
platforms:
  tiktok:
    enabled: true
    cookie: ""              # 登录Cookie（可选）
    user_agent: "Mozilla/5.0 ..."  # 浏览器标识
  
  xhs:
    enabled: true
    cookie: ""              # 小红书Cookie
    user_agent: "Mozilla/5.0 ..."
  
  kuaishou:
    enabled: true
    cookie: ""              # 快手Cookie
    user_agent: "Mozilla/5.0 ..."
```

#### 3. 代理设置（可选）
```yaml
proxy:
  enabled: false          # 是否启用代理
  type: http             # 代理类型: http, https, socks5
  host: ""               # 代理服务器地址
  port: 0                # 代理端口
  username: ""           # 代理用户名（可选）
  password: ""           # 代理密码（可选）
```

### Cookie 获取方法

为了下载某些受限视频，您可能需要配置Cookie：

#### Chrome浏览器获取Cookie:
1. 打开对应平台网站并登录
2. 按F12打开开发者工具
3. 点击"Application"选项卡
4. 在左侧选择"Cookies" > 对应网站
5. 复制所有Cookie值，格式: `name1=value1; name2=value2; ...`

#### 使用配置文件设置Cookie:
您需要在配置文件中设置Cookie，程序会自动使用配置的Cookie进行下载。

## 📖 使用方法

### 1. 命令行模式 (CLI)

#### 下载单个视频
```bash
# 基本下载
./bin/video-downloader download "https://www.tiktok.com/@username/video/1234567890"

# 指定下载路径
./bin/video-downloader download --output ./my-videos "视频URL"

# 指定视频质量
./bin/video-downloader download --quality hd "视频URL"

# 指定输出格式
./bin/video-downloader download --format mp4 "视频URL"
```

#### 批量下载
1. 创建URL文件 `urls.txt`：
```
https://www.tiktok.com/@user1/video/1234567890
https://www.xiaohongshu.com/explore/abcdef
https://www.kuaishou.com/short-video/ghijkl
https://v.douyin.com/xyz123/
```

2. 执行批量下载：
```bash
./bin/video-downloader batch urls.txt
```

#### 注意事项
- 批量下载会按照配置文件中的设置进行
- 可以通过修改配置文件调整并发数和重试次数
- 程序会自动跳过已下载的文件

### 2. 交互式界面 (TUI)

启动交互式界面：
```bash
./bin/video-downloader-tui
```

**界面说明:**
- **主菜单**: 选择不同功能
- **下载管理**: 查看和管理下载任务
- **设置**: 修改配置选项
- **帮助**: 查看使用说明

**快捷键:**
- `↑/↓`: 导航菜单
- `Enter`: 确认选择
- `Tab`: 切换焦点
- `Esc`: 返回上级菜单
- `Ctrl+C`: 退出程序

### 3. Web服务器模式

启动Web服务器：
```bash
./bin/video-downloader server
```

服务器默认运行在 `http://localhost:8080`

#### API接口使用

**下载视频:**
```bash
curl -X POST http://localhost:8080/api/v1/videos/download \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://www.tiktok.com/@username/video/1234567890",
    "output_path": "./downloads",
    "format": "mp4",
    "quality": "hd",
    "download": true
  }'
```

**获取视频信息:**
```bash
curl -X POST http://localhost:8080/api/v1/videos/info \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://www.tiktok.com/@username/video/1234567890"
  }'
```

**查看下载状态:**
```bash
curl http://localhost:8080/api/v1/downloads
```

### 4. 高级功能

#### 配置管理
```bash
# 查看当前配置
./bin/video-downloader config show

# 初始化配置文件
./bin/video-downloader config init
```

#### 数据库查看
```bash
# 查看下载历史
./bin/video-downloader list

# 获取视频信息
./bin/video-downloader info "视频URL"
```

#### 服务器模式
```bash
# 启动API服务器
./bin/video-downloader server
```

## ❓ 常见问题

### Q1: 下载速度很慢怎么办？

**A:** 
1. 检查网络连接
2. 尝试使用代理服务器
3. 调整配置文件中的 `max_workers` 和 `chunk_size`
4. 某些平台在特定时间段限速，可错峰下载

### Q2: 提示"视频不存在"或"无法获取视频信息"

**A:**
1. 确认URL正确且视频存在
2. 检查视频是否为私有或需要登录
3. 配置相应平台的Cookie
4. 视频可能被删除或链接失效

### Q3: 下载的视频没有声音

**A:**
1. 某些平台的视频音画分离，程序会自动合并
2. 检查下载的是否为GIF格式（无音频）
3. 确认原视频本身是否有声音

### Q4: 如何下载私有/登录后才能看的视频？

**A:**
1. 获取浏览器Cookie并配置到`config/config.yaml`文件中
2. 确保Cookie未过期
3. 程序会自动使用配置的Cookie进行访问

### Q5: 程序闪退或报错

**A:**
1. 检查Go版本是否符合要求 (1.21+)
2. 重新编译程序
3. 查看日志文件了解具体错误信息
4. 确保有足够的磁盘空间

### Q6: 如何批量下载某个用户的所有视频？

**A:**
目前程序主要支持单个视频和批量URL下载。如需下载用户的所有视频，您需要：
1. 手动收集该用户的视频URL
2. 将URL保存到文本文件中
3. 使用批量下载功能：`./bin/video-downloader batch urls.txt`

### Q7: 下载后的文件在哪里？

**A:**
默认保存在 `./downloads` 目录下，按平台分类存放：
```
downloads/
├── tiktok/
├── xhs/
└── kuaishou/
```

### Q8: 如何更新程序？

**A:**
```bash
# 如果是从源码安装
cd video-downloader
git pull
make build

# 如果是go install安装
go install github.com/httprunner/video-downloader@latest
```

## 🔧 故障排除

### 编译错误

**错误:** `go: module not found`
**解决:** 
```bash
go mod tidy
go mod download
```

**错误:** `permission denied`
**解决:** 
```bash
# Linux/macOS
chmod +x bin/video-downloader
chmod +x bin/video-downloader-server
chmod +x bin/video-downloader-tui

# Windows: 以管理员身份运行命令提示符
```

### 运行时错误

**错误:** `dial tcp: lookup xxx: no such host`
**解决:** 
1. 检查网络连接
2. 配置DNS服务器
3. 使用代理服务器

**错误:** `database is locked`
**解决:** 
1. 确保没有多个程序实例同时运行
2. 删除 `./data/video-downloader.db-wal` 和 `./data/video-downloader.db-shm` 文件

**错误:** `mkdir: permission denied`
**解决:** 
1. 检查目录权限
2. 使用管理员权限运行
3. 更改下载路径到有权限的目录

### 网络问题

**问题:** 某些视频无法下载
**解决方案:**
1. 更新User-Agent字符串
2. 配置有效的Cookie
3. 使用代理服务器
4. 检查平台是否更新了反爬策略

### 性能问题

**问题:** 下载占用资源过多
**解决方案:**
1. 减少 `max_workers` 数量
2. 调小 `chunk_size`
3. 限制同时下载的任务数

## 📞 获取帮助

如果您遇到本指南未涵盖的问题：

1. **查看程序帮助:**
   ```bash
   ./bin/video-downloader --help
   ./bin/video-downloader download --help
   ```

2. **查看日志文件:**
   日志文件位于 `./logs/` 目录下

3. **提交Issue:**
   访问 [GitHub Issues](https://github.com/httprunner/video-downloader/issues) 提交问题

4. **查看更多文档:**
   - [技术原理文档](./技术原理文档.md)
   - [README.md](../README.md)

## 🎯 小贴士

1. **首次使用建议:**
   - 先用单个视频测试
   - 确认下载路径和文件命名
   - 测试网络连接和代理设置

2. **批量下载建议:**
   - 不要设置过高的并发数
   - 定期检查下载进度
   - 预留足够的存储空间

3. **Cookie管理:**
   - 定期更新Cookie避免失效
   - 不同平台使用不同的浏览器配置
   - 注意保护个人隐私信息

4. **性能优化:**
   - 根据网络情况调整参数
   - 使用SSD存储提高写入速度
   - 关闭不必要的平台支持

## 💡 重要提示

**当前实现的功能：**
- ✅ 单个视频下载
- ✅ 批量URL下载  
- ✅ 视频信息获取
- ✅ TUI交互界面
- ✅ REST API服务器
- ✅ 配置文件管理
- ✅ 数据库存储下载历史

**计划中的功能（尚未实现）：**
- 🔄 用户主页批量下载
- 🔄 自动Cookie提取
- 🔄 评论下载
- 🔄 数据导出功能
- 🔄 断点续传
- 🔄 代理支持参数
- 🔄 Web管理界面

---

希望这个指南能帮助您顺利使用视频下载器！如有问题，欢迎反馈改进。